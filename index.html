<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Birth Date Input</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans KR", sans-serif;
            background: rgba(0, 0, 0, 0.2); /* 20% 반투명 검정 배경 */
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 0;
            box-shadow: none;
            padding: 35px 35px;
            width: 100%;
            max-width: 800px; /* PC에서 최대 너비 제한 */
        }

        .close-button {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 32px;
            height: 32px;
            background: transparent;
            border: none;
            cursor: pointer;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            outline: none;
        }

        .close-button:hover {
            background: transparent;
        }

        .close-button:active {
            background: transparent;
        }

        .close-button:focus {
            outline: none;
        }

        .close-button::before,
        .close-button::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 2px;
            background: #333;
        }

        .close-button::before {
            transform: rotate(45deg);
        }

        .close-button::after {
            transform: rotate(-45deg);
        }

        h1 {
            font-size: 24px;
            color: #000;
            margin-bottom: 25px;
            text-align: center;
            font-weight: 700;
        }

        .description {
            font-size: 14px;
            color: #333;
            margin-bottom: 8px;
            line-height: 1.6;
        }

        .notice {
            font-size: 12px;
            color: #666;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .input-label {
            font-size: 15px;
            color: #333;
            margin-bottom: 12px;
            font-weight: 500;
        }

        .input-group {
            display: flex;
            gap: 12px;
            margin-bottom: 18px;
        }

        .input-wrapper {
            flex: 1;
            position: relative;
        }

        select {
            width: 100%;
            padding: 14px 40px 14px 16px;
            border: 1px solid #999;
            border-radius: 0;
            font-size: 16px;
            color: #333;
            background: white;
            appearance: none;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        select:focus {
            outline: none;
            border-color: #333;
        }

        .select-arrow {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
            width: 0;
            height: 0;
            border-left: 5px solid transparent;
            border-right: 5px solid transparent;
            border-top: 7px solid #666;
        }

        .checkbox-wrapper {
            display: flex;
            align-items: center;
            margin-bottom: 18px;
        }

        .checkbox-wrapper input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-right: 8px;
            cursor: pointer;
            accent-color: #666;
            flex-shrink: 0;
        }

        .checkbox-wrapper label {
            font-size: 14px;
            color: #333;
            cursor: pointer;
            user-select: none;
        }

        button {
            width: 100%;
            padding: 16px;
            background: #333;
            color: white;
            border: none;
            border-radius: 0;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s;
        }

        button:hover {
            background: #000;
        }

        button:active {
            background: #000;
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .debug-info {
            margin-top: 20px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 8px;
            font-size: 12px;
            color: #666;
            display: none;
        }

        /* 태블릿 */
        @media (max-width: 768px) {
            .container {
                max-width: 700px;
                padding: 30px 25px;
            }

            h1 {
                font-size: 22px;
            }

            .input-group {
                gap: 10px;
            }

            select {
                padding: 13px 38px 13px 15px;
                font-size: 15px;
            }

            .select-arrow {
                right: 15px;
            }
        }

        /* 모바일 */
        @media (max-width: 480px) {
            body {
                padding: 15px;
                align-items: center;
            }

            .container {
                max-width: 100%;
                padding: 25px 18px;
                border-radius: 0;
            }

            .close-button {
                top: 15px;
                right: 15px;
                width: 28px;
                height: 28px;
            }

            .close-button::before,
            .close-button::after {
                width: 18px;
            }

            h1 {
                font-size: 20px;
                margin-bottom: 20px;
            }

            .description {
                font-size: 13px;
            }

            .notice {
                font-size: 11px;
                margin-bottom: 20px;
            }

            .input-label {
                font-size: 14px;
            }

            .input-group {
                gap: 8px;
            }

            select {
                padding: 12px 35px 12px 12px;
                font-size: 14px;
            }

            .select-arrow {
                right: 12px;
            }

            .checkbox-wrapper {
                align-items: flex-start;
            }

            .checkbox-wrapper input[type="checkbox"] {
                width: 18px;
                height: 18px;
                margin-top: 2px;
            }

            .checkbox-wrapper label {
                font-size: 13px;
            }

            button {
                padding: 14px;
                font-size: 15px;
            }
        }

        /* 모바일 가로모드 (landscape) */
        @media (max-width: 900px) and (max-height: 500px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 20px 20px;
            }

            .close-button {
                top: 12px;
                right: 12px;
                width: 24px;
                height: 24px;
            }

            .close-button::before,
            .close-button::after {
                width: 16px;
                height: 2px;
            }

            h1 {
                font-size: 18px;
                margin-bottom: 15px;
            }

            .description {
                font-size: 12px;
                margin-bottom: 8px;
            }

            .notice {
                font-size: 11px;
                margin-bottom: 15px;
            }

            .input-label {
                font-size: 13px;
                margin-bottom: 10px;
            }

            .input-group {
                gap: 8px;
                margin-bottom: 15px;
            }

            select {
                padding: 10px 35px 10px 12px;
                font-size: 14px;
            }

            .select-arrow {
                right: 12px;
                border-left: 5px solid transparent;
                border-right: 5px solid transparent;
                border-top: 6px solid #666;
            }

            .checkbox-wrapper {
                margin-bottom: 15px;
            }

            .checkbox-wrapper input[type="checkbox"] {
                width: 18px;
                height: 18px;
                margin-right: 8px;
                margin-top: 1px;
            }

            .checkbox-wrapper label {
                font-size: 12px;
            }

            button {
                padding: 12px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <button class="close-button" id="closeButton" aria-label="Close"></button>
    
    <div class="container">
        <h1 id="pageTitle">Please enter your date of birth.</h1>
        
        <div class="description" id="description">
            This game can only be used by users of a certain age or older.<br>
            Please enter your accurate date of birth to verify your age for service usage.
        </div>
        
        <div class="notice" id="notice">
            * Entering inaccurate information or use by minors below the service age may result in account suspension.
        </div>
        
        <div class="input-label" id="inputLabel">Date of Birth (Day/Month/Year)</div>
        
        <div class="input-group" id="inputGroup">
            <!-- 드롭다운 순서는 JavaScript로 동적 생성 -->
        </div>

        <div class="checkbox-wrapper">
            <input type="checkbox" id="confirmCheckbox">
            <label for="confirmCheckbox" id="checkboxLabel">I have verified the above and entered accurate information.</label>
        </div>

        <button id="confirmButton" disabled>Register</button>

        <div class="debug-info" id="debugInfo"></div>
    </div>

    <script>
        // 다국어 리소스
        const translations = {
            en: {
                pageTitle: "Please enter your date of birth.",
                description: "This game can only be used by users of a certain age or older.<br>Please enter your accurate <strong>date of birth</strong> to verify your age for service usage.",
                notice: "* Entering inaccurate information or use by minors below the service age may result in account suspension.",
                inputLabel: "Date of Birth (Month/Day/Year)",
                checkboxLabel: "I have verified the above and entered accurate information.",
                confirmButton: "Register",
                errorAllFields: "Please fill in all fields.",
                errorCheckbox: "Please check the confirmation box.",
                errorInvalidYear: "Please enter a valid year (1900-2100).",
                errorInvalidMonth: "Please enter a valid month (1-12).",
                errorInvalidDay: "Please enter a valid day (1-31).",
                errorInvalidDate: "This date does not exist.",
                dateOrder: ['month', 'day', 'year'], // 미국식: 월/일/년
                placeholders: {
                    day: "Day",
                    month: "Month",
                    year: "Year"
                }
            },
            ko: {
                pageTitle: "생년월일을 입력해 주세요.",
                description: "본 게임은 특정 연령 이상만 이용할 수 있습니다.<br>서비스 이용 가능 연령을 확인하기 위해 정확한 <strong>생년월일</strong>을 입력해주세요.",
                notice: "* 부정확한 정보를 입력하거나, 서비스 이용 가능 연령 미만의 이용자는 계정 이용이 불가능 할 수 있습니다.",
                inputLabel: "생년월일 (년/월/일)",
                checkboxLabel: "위 내용을 확인하였으며, 정확한 정보를 입력했습니다.",
                confirmButton: "등록",
                errorAllFields: "모든 필드를 입력해주세요.",
                errorCheckbox: "확인 체크박스를 선택해주세요.",
                errorInvalidYear: "올바른 년도를 입력해주세요. (1900-2100)",
                errorInvalidMonth: "올바른 월을 입력해주세요. (1-12)",
                errorInvalidDay: "올바른 일을 입력해주세요. (1-31)",
                errorInvalidDate: "존재하지 않는 날짜입니다.",
                dateOrder: ['year', 'month', 'day'], // 한국식: 년/월/일
                placeholders: {
                    day: "일",
                    month: "월",
                    year: "년"
                }
            },
            ja: {
                pageTitle: "生年月日を入力してください。",
                description: "このゲームは特定の年齢以上のユーザーのみ利用できます。<br>サービス利用可能年齢を確認するため、正確な<strong>生年月日</strong>を入力してください。",
                notice: "* 不正確な情報を入力したり、サービス利用可能年齢未満の利用者はアカウント利用ができない場合があります。",
                inputLabel: "生年月日（年/月/日）",
                checkboxLabel: "上記の内容を確認し、正確な情報を入力しました。",
                confirmButton: "登録",
                errorAllFields: "すべてのフィールドを入力してください。",
                errorCheckbox: "確認チェックボックスを選択してください。",
                errorInvalidYear: "有効な年を入力してください（1900-2100）。",
                errorInvalidMonth: "有効な月を入力してください（1-12）。",
                errorInvalidDay: "有効な日を入力してください（1-31）。",
                errorInvalidDate: "この日付は存在しません。",
                dateOrder: ['year', 'month', 'day'], // 일본식: 년/월/일
                placeholders: {
                    day: "日",
                    month: "月",
                    year: "年"
                }
            },
            pt: {
                pageTitle: "Por favor, insira sua data de nascimento.",
                description: "Este jogo só pode ser usado por usuários de uma certa idade ou mais.<br>Por favor, insira sua <strong>data de nascimento</strong> precisa para verificar sua idade para uso do serviço.",
                notice: "* Inserir informações imprecisas ou uso por menores abaixo da idade de serviço pode resultar em suspensão da conta.",
                inputLabel: "Data de Nascimento (Dia/Mês/Ano)",
                checkboxLabel: "Verifiquei o acima e inseri informações precisas.",
                confirmButton: "Registrar",
                errorAllFields: "Por favor, preencha todos os campos.",
                errorCheckbox: "Por favor, marque a caixa de confirmação.",
                errorInvalidYear: "Por favor, insira um ano válido (1900-2100).",
                errorInvalidMonth: "Por favor, insira um mês válido (1-12).",
                errorInvalidDay: "Por favor, insira um dia válido (1-31).",
                errorInvalidDate: "Esta data não existe.",
                dateOrder: ['day', 'month', 'year'], // 포르투갈식: 일/월/년
                placeholders: {
                    day: "Dia",
                    month: "Mês",
                    year: "Ano"
                }
            },
            ru: {
                pageTitle: "Пожалуйста, введите дату рождения.",
                description: "Эта игра может использоваться только пользователями определенного возраста или старше.<br>Пожалуйста, введите точную <strong>дату рождения</strong> для проверки возраста для использования сервиса.",
                notice: "* Ввод неточной информации или использование несовершеннолетними ниже возраста сервиса может привести к приостановке учетной записи.",
                inputLabel: "Дата рождения (День/Месяц/Год)",
                checkboxLabel: "Я проверил вышеизложенное и ввел точную информацию.",
                confirmButton: "Зарегистрировать",
                errorAllFields: "Пожалуйста, заполните все поля.",
                errorCheckbox: "Пожалуйста, установите флажок подтверждения.",
                errorInvalidYear: "Пожалуйста, введите действительный год (1900-2100).",
                errorInvalidMonth: "Пожалуйста, введите действительный месяц (1-12).",
                errorInvalidDay: "Пожалуйста, введите действительный день (1-31).",
                errorInvalidDate: "Эта дата не существует.",
                dateOrder: ['day', 'month', 'year'], // 러시아식: 일/월/년
                placeholders: {
                    day: "День",
                    month: "Месяц",
                    year: "Год"
                }
            },
            th: {
                pageTitle: "กรุณากรอกวันเกิดของคุณ",
                description: "เกมนี้สามารถใช้ได้เฉพาะผู้ใช้ที่มีอายุตามที่กำหนดขึ้นไปเท่านั้น<br>กรุณากรอก<strong>วันเกิด</strong>ที่ถูกต้องเพื่อยืนยันอายุสำหรับการใช้บริการ",
                notice: "* การกรอกข้อมูลที่ไม่ถูกต้องหรือการใช้งานโดยผู้เยาว์ที่ต่ำกว่าอายุที่กำหนดอาจส่งผลให้บัญชีถูกระงับ",
                inputLabel: "วันเกิด (วัน/เดือน/ปี)",
                checkboxLabel: "ฉันได้ยืนยันข้างต้นและกรอกข้อมูลที่ถูกต้อง",
                confirmButton: "ลงทะเบียน",
                errorAllFields: "กรุณากรอกข้อมูลให้ครบทุกช่อง",
                errorCheckbox: "กรุณาเลือกช่องยืนยัน",
                errorInvalidYear: "กรุณากรอกปีที่ถูกต้อง (1900-2100)",
                errorInvalidMonth: "กรุณากรอกเดือนที่ถูกต้อง (1-12)",
                errorInvalidDay: "กรุณากรอกวันที่ถูกต้อง (1-31)",
                errorInvalidDate: "วันที่นี้ไม่มีอยู่จริง",
                dateOrder: ['day', 'month', 'year'], // 태국식: 일/월/년
                placeholders: {
                    day: "วัน",
                    month: "เดือน",
                    year: "ปี"
                }
            },
            "zh-Hans": {
                pageTitle: "请输入您的出生日期。",
                description: "本游戏仅限特定年龄以上的用户使用。<br>请输入准确的<strong>出生日期</strong>以验证您使用服务的年龄。",
                notice: "* 输入不准确的信息或低于服务年龄的未成年人使用可能导致账户被停用。",
                inputLabel: "出生日期（年/月/日）",
                checkboxLabel: "我已确认以上内容并输入了准确的信息。",
                confirmButton: "注册",
                errorAllFields: "请填写所有字段。",
                errorCheckbox: "请勾选确认框。",
                errorInvalidYear: "请输入有效的年份（1900-2100）。",
                errorInvalidMonth: "请输入有效的月份（1-12）。",
                errorInvalidDay: "请输入有效的日期（1-31）。",
                errorInvalidDate: "此日期不存在。",
                dateOrder: ['year', 'month', 'day'], // 중국식: 년/월/일
                placeholders: {
                    day: "日",
                    month: "月",
                    year: "年"
                }
            },
            "zh-Hant": {
                pageTitle: "請輸入您的出生日期。",
                description: "本遊戲僅限特定年齡以上的使用者使用。<br>請輸入準確的<strong>出生日期</strong>以驗證您使用服務的年齡。",
                notice: "* 輸入不準確的資訊或低於服務年齡的未成年人使用可能導致帳戶被停用。",
                inputLabel: "出生日期（年/月/日）",
                checkboxLabel: "我已確認以上內容並輸入了準確的資訊。",
                confirmButton: "註冊",
                errorAllFields: "請填寫所有欄位。",
                errorCheckbox: "請勾選確認框。",
                errorInvalidYear: "請輸入有效的年份（1900-2100）。",
                errorInvalidMonth: "請輸入有效的月份（1-12）。",
                errorInvalidDay: "請輸入有效的日期（1-31）。",
                errorInvalidDate: "此日期不存在。",
                dateOrder: ['year', 'month', 'day'], // 중국식: 년/월/일
                placeholders: {
                    day: "日",
                    month: "月",
                    year: "年"
                }
            },
            es: {
                pageTitle: "Por favor, ingrese su fecha de nacimiento.",
                description: "Este juego solo puede ser usado por usuarios de cierta edad o mayores.<br>Por favor, ingrese su <strong>fecha de nacimiento</strong> exacta para verificar su edad para el uso del servicio.",
                notice: "* Ingresar información inexacta o el uso por menores de edad por debajo de la edad del servicio puede resultar en la suspensión de la cuenta.",
                inputLabel: "Fecha de Nacimiento (Día/Mes/Año)",
                checkboxLabel: "He verificado lo anterior e ingresado información precisa.",
                confirmButton: "Registrar",
                errorAllFields: "Por favor, complete todos los campos.",
                errorCheckbox: "Por favor, marque la casilla de confirmación.",
                errorInvalidYear: "Por favor, ingrese un año válido (1900-2100).",
                errorInvalidMonth: "Por favor, ingrese un mes válido (1-12).",
                errorInvalidDay: "Por favor, ingrese un día válido (1-31).",
                errorInvalidDate: "Esta fecha no existe.",
                dateOrder: ['day', 'month', 'year'], // 스페인식: 일/월/년
                placeholders: {
                    day: "Día",
                    month: "Mes",
                    year: "Año"
                }
            }
        };

        // URL 파라미터 가져오기
        const urlParams = new URLSearchParams(window.location.search);
        const sdkType = urlParams.get('sdkType') || 'android';
        const langParam = urlParams.get('lang') || 'en';
        const isDebug = urlParams.get('debug') === 'true';

        // 지원하는 언어 목록 (소문자 버전과 실제 키 매핑)
        const languageMap = {
            'en': 'en',
            'ko': 'ko',
            'ja': 'ja',
            'pt': 'pt',
            'ru': 'ru',
            'th': 'th',
            'zh-hans': 'zh-Hans',
            'zh-hant': 'zh-Hant',
            'es': 'es'
        };
        
        // 대소문자 구분 없이 언어 매칭
        function findLanguage(input) {
            const normalizedInput = input.toLowerCase();
            return languageMap[normalizedInput] || 'en';
        }
        
        const currentLang = findLanguage(langParam);

        // DOM 요소
        const pageTitle = document.getElementById('pageTitle');
        const description = document.getElementById('description');
        const notice = document.getElementById('notice');
        const inputLabel = document.getElementById('inputLabel');
        const checkboxLabel = document.getElementById('checkboxLabel');
        const inputGroup = document.getElementById('inputGroup');
        let daySelect, monthSelect, yearSelect;
        const confirmCheckbox = document.getElementById('confirmCheckbox');
        const confirmButton = document.getElementById('confirmButton');
        const closeButton = document.getElementById('closeButton');
        const debugInfo = document.getElementById('debugInfo');

        // 드롭다운 HTML 생성 (언어별 순서에 맞게)
        function createDateInputs() {
            const dateOrder = translations[currentLang].dateOrder;
            const placeholders = translations[currentLang].placeholders;
            inputGroup.innerHTML = '';

            dateOrder.forEach(type => {
                const wrapper = document.createElement('div');
                wrapper.className = 'input-wrapper';

                const select = document.createElement('select');
                select.id = type;

                const placeholder = placeholders[type];

                const option = document.createElement('option');
                option.value = '';
                option.textContent = placeholder;
                select.appendChild(option);

                const arrow = document.createElement('div');
                arrow.className = 'select-arrow';

                wrapper.appendChild(select);
                wrapper.appendChild(arrow);
                inputGroup.appendChild(wrapper);
            });

            // DOM 참조 업데이트
            daySelect = document.getElementById('day');
            monthSelect = document.getElementById('month');
            yearSelect = document.getElementById('year');
        }

        // 드롭다운 옵션 생성
        function populateSelects() {
            // 일 (1-31) - 초기값
            updateDayOptions(31);

            // 월 (1-12)
            for (let i = 1; i <= 12; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = String(i).padStart(2, '0');
                monthSelect.appendChild(option);
            }

            // 년 (1900-현재년도+1)
            const currentYear = new Date().getFullYear();
            for (let i = currentYear + 1; i >= 1900; i--) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                yearSelect.appendChild(option);
            }
        }

        // 일 드롭다운 옵션 업데이트
        function updateDayOptions(maxDays) {
            const currentValue = daySelect.value;
            
            // 기존 옵션 제거 (placeholder 제외)
            while (daySelect.options.length > 1) {
                daySelect.remove(1);
            }

            // 새 옵션 추가
            for (let i = 1; i <= maxDays; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = String(i).padStart(2, '0');
                daySelect.appendChild(option);
            }

            // 이전에 선택한 값 처리
            if (currentValue) {
                const currentDay = parseInt(currentValue);
                if (currentDay <= maxDays) {
                    // 유효한 날짜면 복원
                    daySelect.value = currentValue;
                } else {
                    // 선택한 값이 새로운 최대값보다 크면 최대값으로 자동 조정
                    daySelect.value = maxDays;
                }
            }
        }

        // 년도/월 변경 시 일 드롭다운 업데이트
        function updateDaysBasedOnYearAndMonth() {
            const year = parseInt(yearSelect.value);
            const month = parseInt(monthSelect.value);

            if (year && month) {
                const maxDays = getDaysInMonth(year, month);
                updateDayOptions(maxDays);
            } else if (month) {
                // 년도는 선택 안 했지만 월은 선택한 경우
                // 평년 기준으로 최대 일수 설정
                const maxDays = getDaysInMonth(2023, month); // 평년 예시
                updateDayOptions(maxDays);
            } else {
                // 년도나 월이 선택되지 않았으면 31일까지 표시
                updateDayOptions(31);
            }
        }

        // 다국어 적용
        function applyTranslations() {
            const t = translations[currentLang];
            document.documentElement.lang = currentLang;
            document.title = t.pageTitle;
            pageTitle.textContent = t.pageTitle;
            description.innerHTML = t.description;
            notice.textContent = t.notice;
            inputLabel.textContent = t.inputLabel;
            checkboxLabel.textContent = t.checkboxLabel;
            confirmButton.textContent = t.confirmButton;
        }

        // 초기화
        createDateInputs(); // 언어별 순서로 드롭다운 생성
        populateSelects(); // 옵션 채우기
        applyTranslations();

        // 버튼 활성화 상태 업데이트
        function updateButtonState() {
            const hasDay = daySelect.value !== '';
            const hasMonth = monthSelect.value !== '';
            const hasYear = yearSelect.value !== '';
            const isChecked = confirmCheckbox.checked;

            // 모든 필드가 입력되고 체크박스도 체크되어야 활성화
            confirmButton.disabled = !(hasDay && hasMonth && hasYear && isChecked);
        }

        // 년도/월 변경 시 일 드롭다운 업데이트
        yearSelect.addEventListener('change', function() {
            updateDaysBasedOnYearAndMonth();
            updateButtonState();
        });
        
        monthSelect.addEventListener('change', function() {
            updateDaysBasedOnYearAndMonth();
            updateButtonState();
        });

        daySelect.addEventListener('change', updateButtonState);

        // 체크박스 상태에 따라 버튼 활성화/비활성화
        confirmCheckbox.addEventListener('change', updateButtonState);

        // 디버그 모드
        if (isDebug) {
            debugInfo.style.display = 'block';
            debugInfo.textContent = `SDK Type: ${sdkType}, Language: ${currentLang}`;
        }

        // 윤년 체크
        function isLeapYear(year) {
            return (year % 4 === 0 && year % 100 !== 0) || (year % 400 === 0);
        }

        // 해당 월의 최대 일수 반환
        function getDaysInMonth(year, month) {
            const daysInMonth = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
            if (month === 2 && isLeapYear(year)) {
                return 29;
            }
            return daysInMonth[month - 1];
        }

        // 유효성 검사
        function validateDate(year, month, day) {
            const t = translations[currentLang];

            if (!year || !month || !day) {
                return t.errorAllFields;
            }

            if (!confirmCheckbox.checked) {
                return t.errorCheckbox;
            }

            const yearNum = parseInt(year);
            const monthNum = parseInt(month);
            const dayNum = parseInt(day);

            if (yearNum < 1900 || yearNum > 2100) {
                return t.errorInvalidYear;
            }

            if (monthNum < 1 || monthNum > 12) {
                return t.errorInvalidMonth;
            }

            if (dayNum < 1 || dayNum > 31) {
                return t.errorInvalidDay;
            }

            // 해당 월의 최대 일수 체크 (윤년 포함)
            const maxDays = getDaysInMonth(yearNum, monthNum);
            if (dayNum > maxDays) {
                return t.errorInvalidDate;
            }

            // 실제 날짜 유효성 검사 (추가 안전장치)
            const date = new Date(yearNum, monthNum - 1, dayNum);
            if (date.getFullYear() !== yearNum || 
                date.getMonth() !== monthNum - 1 || 
                date.getDate() !== dayNum) {
                return t.errorInvalidDate;
            }

            return null;
        }

        // YYYYMMDD 형식으로 변환
        function formatBirthDate(year, month, day) {
            const paddedMonth = String(month).padStart(2, '0');
            const paddedDay = String(day).padStart(2, '0');
            return `${year}${paddedMonth}${paddedDay}`;
        }

        // 네이티브로 결과 전달
        function sendResultToNative(birthDate) {
            const result = {
                code: 1,
                message: "birthInfo",
                birth: birthDate
            };
            const jsonString = JSON.stringify(result);

            try {
                switch(sdkType.toLowerCase()) {
                    case 'android':
                        if (window.android && window.android.onResultForBirth) {
                            window.android.onResultForBirth(jsonString);
                        } else {
                            console.error('Android bridge not found');
                            if (isDebug) alert('Android bridge not found\n' + jsonString);
                        }
                        break;

                    case 'ios':
                        if (window.webkit && 
                            window.webkit.messageHandlers && 
                            window.webkit.messageHandlers.onResultForBirth) {
                            window.webkit.messageHandlers.onResultForBirth.postMessage(jsonString);
                        } else {
                            console.error('iOS bridge not found');
                            if (isDebug) alert('iOS bridge not found\n' + jsonString);
                        }
                        break;

                    case 'unity':
                        const parameters = {
                            method: "onResultForBirth",
                            data: jsonString
                        };
                        window.alert(JSON.stringify(parameters));
                        break;

                    case 'unreal':
                        if (window.ue && window.ue.web && window.ue.web.onresultforbirth) {
                            window.ue.web.onresultforbirth(jsonString);
                        } else {
                            console.error('Unreal bridge not found');
                            if (isDebug) alert('Unreal bridge not found\n' + jsonString);
                        }
                        break;

                    default:
                        console.error('Unknown SDK type: ' + sdkType);
                        if (isDebug) alert('Unknown SDK type: ' + sdkType + '\n' + jsonString);
                }
            } catch (error) {
                console.error('Error sending result to native:', error);
                if (isDebug) alert('Error: ' + error.message + '\n' + jsonString);
            }
        }

        // 확인 버튼 클릭
        confirmButton.addEventListener('click', function() {
            const day = daySelect.value;
            const month = monthSelect.value;
            const year = yearSelect.value;

            const error = validateDate(year, month, day);
            if (error) {
                // 에러가 있으면 그냥 반환 (UI에 표시하지 않음)
                return;
            }

            const birthDate = formatBirthDate(year, month, day);
            sendResultToNative(birthDate);
        });

        // 닫기 버튼 클릭
        closeButton.addEventListener('click', function() {
            const result = {
                code: 0,
                message: "closed",
                birth: ""
            };
            const jsonString = JSON.stringify(result);

            try {
                switch(sdkType.toLowerCase()) {
                    case 'android':
                        if (window.android && window.android.onResultForBirth) {
                            window.android.onResultForBirth(jsonString);
                        } else {
                            console.error('Android bridge not found');
                            if (isDebug) alert('Android bridge not found\n' + jsonString);
                        }
                        break;

                    case 'ios':
                        if (window.webkit && 
                            window.webkit.messageHandlers && 
                            window.webkit.messageHandlers.onResultForBirth) {
                            window.webkit.messageHandlers.onResultForBirth.postMessage(jsonString);
                        } else {
                            console.error('iOS bridge not found');
                            if (isDebug) alert('iOS bridge not found\n' + jsonString);
                        }
                        break;

                    case 'unity':
                        const parameters = {
                            method: "onResultForBirth",
                            data: jsonString
                        };
                        window.alert(JSON.stringify(parameters));
                        break;

                    case 'unreal':
                        if (window.ue && window.ue.web && window.ue.web.onresultforbirth) {
                            window.ue.web.onresultforbirth(jsonString);
                        } else {
                            console.error('Unreal bridge not found');
                            if (isDebug) alert('Unreal bridge not found\n' + jsonString);
                        }
                        break;

                    default:
                        console.error('Unknown SDK type: ' + sdkType);
                        if (isDebug) alert('Unknown SDK type: ' + sdkType + '\n' + jsonString);
                }
            } catch (error) {
                console.error('Error sending result to native:', error);
                if (isDebug) alert('Error: ' + error.message + '\n' + jsonString);
            }
        });
    </script>
</body>
</html>
